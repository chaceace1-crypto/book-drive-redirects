<script>
  const AMAZON_URL =
    "https://www.amazon.com/registries/gl/guest-view/ZDTUNIPEUK0?ref_=cm_sw_r_cp_ud_ggr-subnav-share_023JZ5HMZA5EQF5X58K7_1";

  const params = new URLSearchParams(window.location.search);

  // Force GA4 to register the page view WITH UTMs
  gtag('event', 'page_view', {
    page_location: window.location.href,
    page_referrer: document.referrer
  });

  // Build redirect URL with UTMs preserved
  const utmParams = new URLSearchParams();
  ["utm_source", "utm_medium", "utm_campaign", "utm_content", "utm_term"]
    .forEach(key => {
      if (params.has(key)) {
        utmParams.set(key, params.get(key));
      }
    });

  const redirectUrl = utmParams.toString()
    ? AMAZON_URL + "&" + utmParams.toString()
    : AMAZON_URL;

  // Give GA time to lock the session
  setTimeout(() => {
    window.location.replace(redirectUrl);
  }, 1800);
</script>
